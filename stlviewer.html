<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.jså¤šSTLæ–‡ä»¶å¯è§†åŒ–</title>
    <script src="./js/three.min.js"></script>
    <script src="./js/OrbitControls.js"></script>
    <script src="./js/STLLoader.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #2c3e50);
            color: #ecf0f1;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            margin-top: 20px;
        }
        
        .viewer-section {
            flex: 2;
            min-width: 300px;
            background: rgba(25, 35, 65, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .controls-section {
            flex: 1;
            min-width: 300px;
            background: rgba(25, 35, 65, 0.7);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        #stl-viewer {
            width: 100%;
            height: 800px;
            background: rgba(10, 15, 30, 0.6);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
        }
        
        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            background: rgba(10, 20, 40, 0.4);
            cursor: pointer;
        }
        
        .upload-area:hover {
            background: rgba(52, 152, 219, 0.2);
            border-color: #2ecc71;
        }
        
        .upload-area i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
            color: #3498db;
        }
        
        .upload-area p {
            margin-bottom: 15px;
        }
        
        .btn {
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .model-controls {
            background: rgba(10, 20, 40, 0.4);
            border-radius: 10px;
            padding: 20px;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            font-size: 1.1rem;
            margin-bottom: 12px;
            color: #2ecc71;
        }
        
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .slider-container label {
            min-width: 80px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: rgba(200, 200, 200, 0.2);
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #3498db;
            cursor: pointer;
        }
        
        .model-list {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .model-item {
            padding: 10px;
            background: rgba(52, 152, 219, 0.1);
            margin-bottom: 8px;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .model-item.active {
            background: rgba(46, 204, 113, 0.2);
            border-left: 4px solid #2ecc71;
        }
        
        .model-name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 70%;
        }
        
        .delete-btn {
            background: rgba(231, 76, 60, 0.3);
            color: #e74c3c;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.8);
            color: white;
        }
        
        .instructions {
            background: rgba(10, 20, 40, 0.4);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .instructions ul {
            padding-left: 20px;
            margin-top: 10px;
        }
        
        .instructions li {
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .instructions li strong {
            color: #3498db;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¤šSTLæ–‡ä»¶3Då¯è§†åŒ–å·¥å…·</h1>
            <p class="subtitle">ä½¿ç”¨Three.jsæŠ€æœ¯åŒæ—¶åŠ è½½å’Œå±•ç¤ºå¤šä¸ªSTLæ ¼å¼çš„3Dæ¨¡å‹ï¼Œæ”¯æŒæ¨¡å‹ä½ç½®ã€æ—‹è½¬å’Œç¼©æ”¾è°ƒæ•´</p>
        </header>
        
        <div class="content">
            <section class="viewer-section">
                <h2 class="section-title">3Dæ¨¡å‹é¢„è§ˆåŒº</h2>
                <div id="stl-viewer"></div>
            </section>
            
            <section class="controls-section">
                <h2 class="section-title">æ¨¡å‹æ§åˆ¶é¢æ¿</h2>
                
                <div class="upload-area" id="drop-zone">
                    <i>ğŸ“</i>
                    <p>æ‹–æ”¾STLæ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </p>
                    <input type="file" id="file-input" accept=".stl" multiple style="display: none;">
                    <button class="btn" onclick="document.getElementById('file-input').click()">é€‰æ‹©STLæ–‡ä»¶</button>
                </div>
                
                <div class="model-controls">
                    <h3>å·²åŠ è½½æ¨¡å‹</h3>
                    <div class="model-list" id="model-list">
                        <p style="text-align: center; opacity: 0.7;">æš‚æ— æ¨¡å‹ï¼Œè¯·ä¸Šä¼ STLæ–‡ä»¶</p>
                    </div>
                </div>
                
                <div class="model-controls">
                    <h3>æ¨¡å‹æ§åˆ¶</h3>
                    <!-- ä½ç½®æ§åˆ¶ç»„ -->
                    <div class="control-group">
                        <div class="slider-container">
                            <label>ä½ç½® X:</label>
                            <input type="range" id="pos-x" min="-50" max="50" value="0" step="0.1">
                            <input type="number" id="pos-x-input" min="-50" max="50" value="0" step="0.1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="slider-container">
                            <label>ä½ç½® Y:</label>
                            <input type="range" id="pos-y" min="-50" max="50" value="0" step="0.1">
                            <input type="number" id="pos-y-input" min="-50" max="50" value="0" step="0.1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="slider-container">
                            <label>ä½ç½® Z:</label>
                            <input type="range" id="pos-z" min="-50" max="50" value="0" step="0.1">
                            <input type="number" id="pos-z-input" min="-50" max="50" value="0" step="0.1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                    </div>

                    <!-- æ—‹è½¬æ§åˆ¶ç»„ -->
                    <div class="control-group">
                        <div class="slider-container">
                            <label>æ—‹è½¬ X:</label>
                            <input type="range" id="rot-x" min="0" max="360" value="0" step="1">
                            <input type="number" id="rot-x-input" min="0" max="360" value="0" step="1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="slider-container">
                            <label>æ—‹è½¬ Y:</label>
                            <input type="range" id="rot-y" min="0" max="360" value="0" step="1">
                            <input type="number" id="rot-y-input" min="0" max="360" value="0" step="1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                        <div class="slider-container">
                            <label>æ—‹è½¬ Z:</label>
                            <input type="range" id="rot-z" min="0" max="360" value="0" step="1">
                            <input type="number" id="rot-z-input" min="0" max="360" value="0" step="1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                    </div>

                    <!-- ç¼©æ”¾æ§åˆ¶ç»„ -->
                    <div class="control-group">
                        <div class="slider-container">
                            <label>ç¼©æ”¾:</label>
                            <input type="range" id="scale" min="0.1" max="5" value="1" step="0.1">
                            <input type="number" id="scale-input" min="0.1" max="5" value="1" step="0.1" style="width: 80px; padding: 4px; border-radius: 4px; border: 1px solid #3498db; background: rgba(255, 255, 255, 0.1); color: white;">
                        </div>
                    </div>



                </div>
            </section>
        </div>
        
        <div class="instructions">
            <h3>ä½¿ç”¨è¯´æ˜ï¼š</h3>
            <ul>
                <li><strong>ä¸Šä¼ æ–‡ä»¶</strong>ï¼šç‚¹å‡»"é€‰æ‹©STLæ–‡ä»¶"æŒ‰é’®æˆ–æ‹–æ”¾STLæ–‡ä»¶åˆ°ä¸Šä¼ åŒºåŸŸ</li>
                <li><strong>å¯¼èˆªæ§åˆ¶</strong>ï¼šå·¦é”®æ‹–åŠ¨æ—‹è½¬è§†å›¾ï¼Œå³é”®æ‹–åŠ¨å¹³ç§»ï¼Œæ»šè½®ç¼©æ”¾</li>
                <li><strong>æ¨¡å‹é€‰æ‹©</strong>ï¼šåœ¨å·²åŠ è½½æ¨¡å‹åˆ—è¡¨ä¸­ç‚¹å‡»é€‰æ‹©è¦æ“ä½œçš„æ¨¡å‹</li>
                <li><strong>ä½ç½®è°ƒæ•´</strong>ï¼šä½¿ç”¨ä½ç½®æ»‘å—è°ƒæ•´æ¨¡å‹åœ¨X/Y/Zè½´çš„ä½ç½®</li>
                <li><strong>æ—‹è½¬æ§åˆ¶</strong>ï¼šä½¿ç”¨æ—‹è½¬æ»‘å—è°ƒæ•´æ¨¡å‹åœ¨X/Y/Zè½´çš„æ—‹è½¬è§’åº¦</li>
                <li><strong>ç¼©æ”¾æ§åˆ¶</strong>ï¼šä½¿ç”¨ç¼©æ”¾æ»‘å—è°ƒæ•´æ¨¡å‹å¤§å°</li>
                <li><strong>åˆ é™¤æ¨¡å‹</strong>ï¼šç‚¹å‡»æ¨¡å‹é¡¹å³ä¾§çš„åˆ é™¤æŒ‰é’®ç§»é™¤æ¨¡å‹</li>
            </ul>
        </div>
        
        <footer>
            <p>Â© 2023 Three.js STLå¯è§†åŒ–å·¥å…· | ä½¿ç”¨Three.js v0.132.2</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let scene, camera, renderer, controls;
        let stlLoader;
        let models = [];
        let activeModel = null;
        
        // åˆå§‹åŒ–åœºæ™¯
        function init() {
            // åˆ›å»ºåœºæ™¯
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0c1c3f);
            scene.fog = new THREE.Fog(0x0c1c3f, 20, 100);
            
            // åˆ›å»ºç›¸æœº
            camera = new THREE.PerspectiveCamera(
                75, 
                window.innerWidth / window.innerHeight, 
                0.1, 
                1000
            );
            camera.position.z = 30;
            camera.position.y = 15;
            
            // åˆ›å»ºæ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(document.getElementById('stl-viewer').offsetWidth, 
                            document.getElementById('stl-viewer').offsetHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('stl-viewer').appendChild(renderer.domElement);
            
            // æ·»åŠ è½¨é“æ§åˆ¶
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            
            // æ·»åŠ å…‰æº
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight1.position.set(1, 1, 1);
            scene.add(directionalLight1);
            
            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.5);
            directionalLight2.position.set(-1, -1, -1);
            scene.add(directionalLight2);
            
            // æ·»åŠ åæ ‡è½´è¾…åŠ©
            const axesHelper = new THREE.AxesHelper(10);
            scene.add(axesHelper);
            
            // æ·»åŠ ç½‘æ ¼åœ°é¢
            const gridHelper = new THREE.GridHelper(50, 20, 0x3498db, 0x2c3e50);
            scene.add(gridHelper);
            
            // åˆå§‹åŒ–STLåŠ è½½å™¨
            stlLoader = new THREE.STLLoader();
            
            // æ·»åŠ çª—å£å¤§å°è°ƒæ•´ç›‘å¬
            window.addEventListener('resize', onWindowResize);
            
            // è®¾ç½®æ–‡ä»¶æ‹–æ”¾äº‹ä»¶
            setupDragAndDrop();
            
            // è®¾ç½®æ§åˆ¶äº‹ä»¶
            setupControls();
            
            // å¼€å§‹åŠ¨ç”»å¾ªç¯
            animate();
            
            // åŠ è½½ç¤ºä¾‹æ¨¡å‹
            loadExampleModels();
        }
        
        // åŠ è½½ç¤ºä¾‹æ¨¡å‹
        function loadExampleModels() {
            const exampleModels = [
                './meshes/link11.STL',
                './meshes/link12.STL',
                './meshes/link13.STL',

            ];
            
            exampleModels.forEach((url, index) => {
                stlLoader.load(url, function (geometry) {
                    createModel(geometry, `ç¤ºä¾‹æ¨¡å‹ ${index + 1}`, getRandomColor());
                });
            });
        }
        
        // åˆ›å»ºæ¨¡å‹
        function createModel(geometry, name, color) {
            const material = new THREE.MeshPhongMaterial({ 
                color: color,
                specular: 0x111111,
                shininess: 80,
                flatShading: true
            });
            
            const mesh = new THREE.Mesh(geometry, material);
            
            // è®¡ç®—å‡ ä½•ä¸­å¿ƒå¹¶å±…ä¸­æ¨¡å‹
            geometry.computeBoundingBox();
            const center = new THREE.Vector3();
            geometry.boundingBox.getCenter(center);
            mesh.geometry.center();
            
            // æ ¹æ®æ¨¡å‹æ•°é‡è®¾ç½®ä½ç½®
            const spacing = 15;
            const x = (models.length % 3 - 1) * spacing;
            const z = Math.floor(models.length / 3) * spacing;
            mesh.position.set(x, 0, z);
            
            // æ·»åŠ åˆ°åœºæ™¯
            scene.add(mesh);
            
            // å­˜å‚¨æ¨¡å‹ä¿¡æ¯
            const modelInfo = {
                name: name,
                mesh: mesh,
                color: color,
                defaultPosition: { x: x, y: 0, z: z },
                defaultRotation: { x: 0, y: 0, z: 0 },
                defaultScale: 1
            };
            
            models.push(modelInfo);
            
            // æ·»åŠ åˆ°æ¨¡å‹åˆ—è¡¨
            addToModelList(modelInfo);
            
            // è®¾ç½®ä¸ºæ´»åŠ¨æ¨¡å‹
            setActiveModel(modelInfo);
        }
        
        // æ·»åŠ åˆ°æ¨¡å‹åˆ—è¡¨
        function addToModelList(model) {
            const modelList = document.getElementById('model-list');
            
            // å¦‚æœæ˜¾ç¤º"æš‚æ— æ¨¡å‹"åˆ™ç§»é™¤
            if (modelList.querySelector('p')) {
                modelList.innerHTML = '';
            }
            
            const modelItem = document.createElement('div');
            modelItem.className = 'model-item';
            modelItem.innerHTML = `
                <div class="model-name">${model.name}</div>
                <button class="delete-btn" data-id="${models.length - 1}">Ã—</button>
            `;
            
            modelItem.addEventListener('click', () => {
                setActiveModel(model);
            });
            
            modelList.appendChild(modelItem);
            
            // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶
            const deleteBtn = modelItem.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteModel(model);
            });
        }
        
        // è®¾ç½®æ´»åŠ¨æ¨¡å‹
        function setActiveModel(model) {
            // ç§»é™¤ä¹‹å‰çš„æ´»åŠ¨çŠ¶æ€
            document.querySelectorAll('.model-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // è®¾ç½®æ–°æ´»åŠ¨æ¨¡å‹
            activeModel = model;
            
            // æ‰¾åˆ°å¯¹åº”çš„åˆ—è¡¨é¡¹å¹¶æ·»åŠ æ´»åŠ¨çŠ¶æ€
            const modelItems = document.querySelectorAll('.model-item');
            modelItems.forEach((item, index) => {
                if (models[index] === model) {
                    item.classList.add('active');
                }
            });
            
            // æ›´æ–°æ§åˆ¶æ»‘å—
            updateControlSliders();
        }
        
        // æ›´æ–°æ§åˆ¶æ»‘å—
        function updateControlSliders() {
            if (!activeModel) return;
            
            // document.getElementById('pos-x').value = activeModel.mesh.position.x;
            // document.getElementById('pos-y').value = activeModel.mesh.position.y;
            // document.getElementById('pos-z').value = activeModel.mesh.position.z;
            
            // document.getElementById('rot-x').value = THREE.MathUtils.radToDeg(activeModel.mesh.rotation.x);
            // document.getElementById('rot-y').value = THREE.MathUtils.radToDeg(activeModel.mesh.rotation.y);
            // document.getElementById('rot-z').value = THREE.MathUtils.radToDeg(activeModel.mesh.rotation.z);
            
            // document.getElementById('scale').value = activeModel.mesh.scale.x;

            // ä½ç½®è¾“å…¥æ¡†åŒæ­¥
            document.getElementById('pos-x').value = activeModel.mesh.position.x;
            document.getElementById('pos-x-input').value = activeModel.mesh.position.x.toFixed(1); // ä¿ç•™1ä½å°æ•°
            document.getElementById('pos-y').value = activeModel.mesh.position.y;
            document.getElementById('pos-y-input').value = activeModel.mesh.position.y.toFixed(1);
            document.getElementById('pos-z').value = activeModel.mesh.position.z;
            document.getElementById('pos-z-input').value = activeModel.mesh.position.z.toFixed(1);
            
            // æ—‹è½¬è¾“å…¥æ¡†åŒæ­¥ï¼ˆè§’åº¦è½¬æ•°å€¼ï¼‰
            const rotX = THREE.MathUtils.radToDeg(activeModel.mesh.rotation.x);
            const rotY = THREE.MathUtils.radToDeg(activeModel.mesh.rotation.y);
            const rotZ = THREE.MathUtils.radToDeg(activeModel.mesh.rotation.z);
            document.getElementById('rot-x').value = rotX;
            document.getElementById('rot-x-input').value = rotX.toFixed(0); // æ•´æ•°
            document.getElementById('rot-y').value = rotY;
            document.getElementById('rot-y-input').value = rotY.toFixed(0);
            document.getElementById('rot-z').value = rotZ;
            document.getElementById('rot-z-input').value = rotZ.toFixed(0);
            
            // ç¼©æ”¾è¾“å…¥æ¡†åŒæ­¥
            const scale = activeModel.mesh.scale.x;
            document.getElementById('scale').value = scale;
            document.getElementById('scale-input').value = scale.toFixed(1);
        }

      
        // åˆ é™¤æ¨¡å‹
        function deleteModel(model) {
            // ä»åœºæ™¯ä¸­ç§»é™¤æ¨¡å‹
            scene.remove(model.mesh);
            
            // ä»æ¨¡å‹ä¸­ç§»é™¤
            const index = models.indexOf(model);
            if (index !== -1) {
                models.splice(index, 1);
            }
            
            // æ›´æ–°æ¨¡å‹åˆ—è¡¨
            const modelList = document.getElementById('model-list');
            modelList.innerHTML = models.length === 0 ? 
                '<p style="text-align: center; opacity: 0.7;">æš‚æ— æ¨¡å‹ï¼Œè¯·ä¸Šä¼ STLæ–‡ä»¶</p>' : '';
            
            // é‡æ–°æ·»åŠ å‰©ä½™æ¨¡å‹åˆ°åˆ—è¡¨
            models.forEach((model, idx) => {
                const modelItem = document.createElement('div');
                modelItem.className = 'model-item';
                if (model === activeModel) modelItem.classList.add('active');
                modelItem.innerHTML = `
                    <div class="model-name">${model.name}</div>
                    <button class="delete-btn" data-id="${idx}">Ã—</button>
                `;
                
                modelItem.addEventListener('click', () => {
                    setActiveModel(model);
                });
                
                const deleteBtn = modelItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteModel(model);
                });
                
                modelList.appendChild(modelItem);
            });
            
            // å¦‚æœæ²¡æœ‰æ´»åŠ¨æ¨¡å‹ä¸”è¿˜æœ‰æ¨¡å‹ï¼Œè®¾ç½®ç¬¬ä¸€ä¸ªä¸ºæ´»åŠ¨æ¨¡å‹
            if (models.length > 0 && !activeModel) {
                setActiveModel(models[0]);
            } else {
                activeModel = null;
            }
        }
        
        // è®¾ç½®æ‹–æ”¾äº‹ä»¶
        function setupDragAndDrop() {
            const dropZone = document.getElementById('drop-zone');
            const fileInput = document.getElementById('file-input');
            
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            dropZone.addEventListener('click', () => {
                fileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©å˜åŒ–
            fileInput.addEventListener('change', handleFileSelect);
            
            // æ‹–æ”¾äº‹ä»¶
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.style.backgroundColor = 'rgba(52, 152, 219, 0.3)';
                dropZone.style.borderColor = '#2ecc71';
            });
            
            dropZone.addEventListener('dragleave', () => {
                dropZone.style.backgroundColor = 'rgba(10, 20, 40, 0.4)';
                dropZone.style.borderColor = '#3498db';
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.style.backgroundColor = 'rgba(10, 20, 40, 0.4)';
                dropZone.style.borderColor = '#3498db';
                
                if (e.dataTransfer.files.length) {
                    handleFiles(e.dataTransfer.files);
                }
            });
        }
        
        // å¤„ç†æ–‡ä»¶é€‰æ‹©
        function handleFileSelect(e) {
            if (e.target.files.length) {
                handleFiles(e.target.files);
            }
        }
        
        // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºSTLæ–‡ä»¶
                if (!file.name.toLowerCase().endsWith('.stl')) {
                    alert('è¯·ä¸Šä¼ STLæ ¼å¼çš„æ–‡ä»¶');
                    continue;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        // å°è¯•è§£æSTLæ–‡ä»¶
                        const geometry = stlLoader.parse(event.target.result);
                        createModel(geometry, file.name, getRandomColor());
                    } catch (error) {
                        // è§£æå¤±è´¥æ—¶æç¤ºç”¨æˆ·
                        alert(`æ–‡ä»¶ ${file.name} åŠ è½½å¤±è´¥ï¼š${error.message}`);
                    }
                };
                
                // æ–°å¢ï¼šå¤„ç†æ–‡ä»¶è¯»å–å¤±è´¥çš„æƒ…å†µ
                reader.onerror = function() {
                    alert(`æ–‡ä»¶ ${file.name} è¯»å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æŸå`);
                };
                
                reader.readAsArrayBuffer(file);
            }
        }
        
        // è®¾ç½®æ§åˆ¶äº‹ä»¶
        function setupControls() {
            // ä½ç½®æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('pos-x').addEventListener('input', (e) => {
                if (activeModel) {
                    const value = parseFloat(e.target.value);
                    activeModel.mesh.position.x = value;
                    document.getElementById('pos-x-input').value = value.toFixed(1); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // ä½ç½®æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('pos-x-input').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                if (!isNaN(value) && activeModel) {
                    activeModel.mesh.position.x = value;
                    document.getElementById('pos-x').value = value; // æ›´æ–°æ»‘å—
                }
            });

            // ä½ç½®æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('pos-y').addEventListener('input', (e) => {
                if (activeModel) {
                    const value = parseFloat(e.target.value);
                    activeModel.mesh.position.y = value;
                    document.getElementById('pos-y-input').value = value.toFixed(1); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // ä½ç½®æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('pos-y-input').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                if (!isNaN(value) && activeModel) {
                    activeModel.mesh.position.y = value;
                    document.getElementById('pos-y').value = value; // æ›´æ–°æ»‘å—
                }
            });
            // ä½ç½®æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('pos-z').addEventListener('input', (e) => {
                if (activeModel) {
                    const value = parseFloat(e.target.value);
                    activeModel.mesh.position.z = value;
                    document.getElementById('pos-z-input').value = value.toFixed(1); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // ä½ç½®æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('pos-z-input').addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                if (!isNaN(value) && activeModel) {
                    activeModel.mesh.position.z = value;
                    document.getElementById('pos-z').value = value; // æ›´æ–°æ»‘å—
                }
            });

            // æ—‹è½¬æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('rot-x').addEventListener('input', (e) => {
                if (activeModel) {
                    const deg = parseFloat(e.target.value);
                    activeModel.mesh.rotation.x = THREE.MathUtils.degToRad(deg);
                    document.getElementById('rot-x-input').value = deg.toFixed(0); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // æ—‹è½¬æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('rot-x-input').addEventListener('input', (e) => {
                const deg = parseFloat(e.target.value);
                if (!isNaN(deg) && activeModel) {
                    activeModel.mesh.rotation.x = THREE.MathUtils.degToRad(deg);
                    document.getElementById('rot-x').value = deg; // æ›´æ–°æ»‘å—
                }
            });
            // æ—‹è½¬æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('rot-y').addEventListener('input', (e) => {
                if (activeModel) {
                    const deg = parseFloat(e.target.value);
                    activeModel.mesh.rotation.y = THREE.MathUtils.degToRad(deg);
                    document.getElementById('rot-y-input').value = deg.toFixed(0); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // æ—‹è½¬æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('rot-y-input').addEventListener('input', (e) => {
                const deg = parseFloat(e.target.value);
                if (!isNaN(deg) && activeModel) {
                    activeModel.mesh.rotation.y = THREE.MathUtils.degToRad(deg);
                    document.getElementById('rot-y').value = deg; // æ›´æ–°æ»‘å—
                }
            });
            // æ—‹è½¬æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('rot-z').addEventListener('input', (e) => {
                if (activeModel) {
                    const deg = parseFloat(e.target.value);
                    activeModel.mesh.rotation.z = THREE.MathUtils.degToRad(deg);
                    document.getElementById('rot-z-input').value = deg.toFixed(0); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // æ—‹è½¬æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('rot-z-input').addEventListener('input', (e) => {
                const deg = parseFloat(e.target.value);
                if (!isNaN(deg) && activeModel) {
                    activeModel.mesh.rotation.z = THREE.MathUtils.degToRad(deg);
                    document.getElementById('rot-z').value = deg; // æ›´æ–°æ»‘å—
                }
            });

            // ç¼©æ”¾æ§åˆ¶ï¼ˆæ»‘å—â†’è¾“å…¥æ¡†ï¼‰
            document.getElementById('scale').addEventListener('input', (e) => {
                if (activeModel) {
                    const scale = parseFloat(e.target.value);
                    activeModel.mesh.scale.set(scale, scale, scale);
                    document.getElementById('scale-input').value = scale.toFixed(1); // æ›´æ–°è¾“å…¥æ¡†
                }
            });
            // ç¼©æ”¾æ§åˆ¶ï¼ˆè¾“å…¥æ¡†â†’æ»‘å—ï¼‰
            document.getElementById('scale-input').addEventListener('input', (e) => {
                const scale = parseFloat(e.target.value);
                if (!isNaN(scale) && activeModel) {
                    activeModel.mesh.scale.set(scale, scale, scale);
                    document.getElementById('scale').value = scale; // æ›´æ–°æ»‘å—
                }
            });

            // ä½ç½®æ§åˆ¶
            document.getElementById('pos-x').addEventListener('input', (e) => {
                if (activeModel) activeModel.mesh.position.x = parseFloat(e.target.value);
            });
            
            document.getElementById('pos-y').addEventListener('input', (e) => {
                if (activeModel) activeModel.mesh.position.y = parseFloat(e.target.value);
            });
            
            document.getElementById('pos-z').addEventListener('input', (e) => {
                if (activeModel) activeModel.mesh.position.z = parseFloat(e.target.value);
            });
            
            // æ—‹è½¬æ§åˆ¶
            document.getElementById('rot-x').addEventListener('input', (e) => {
                if (activeModel) activeModel.mesh.rotation.x = THREE.MathUtils.degToRad(parseFloat(e.target.value));
            });
            
            document.getElementById('rot-y').addEventListener('input', (e) => {
                if (activeModel) activeModel.mesh.rotation.y = THREE.MathUtils.degToRad(parseFloat(e.target.value));
            });
            
            document.getElementById('rot-z').addEventListener('input', (e) => {
                if (activeModel) activeModel.mesh.rotation.z = THREE.MathUtils.degToRad(parseFloat(e.target.value));
            });
            
            // ç¼©æ”¾æ§åˆ¶
            document.getElementById('scale').addEventListener('input', (e) => {
                if (activeModel) {
                    const scale = parseFloat(e.target.value);
                    activeModel.mesh.scale.set(scale, scale, scale);
                }
            });
        }
        
        // çª—å£å¤§å°è°ƒæ•´
        function onWindowResize() {
            camera.aspect = document.getElementById('stl-viewer').offsetWidth / 
                            document.getElementById('stl-viewer').offsetHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(document.getElementById('stl-viewer').offsetWidth, 
                            document.getElementById('stl-viewer').offsetHeight);
        }
        
        // åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        
        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = [
                0xff6b6b, 0x4ecdc4, 0xffbe0b, 0xfb5607, 
                0x8338ec, 0x3a86ff, 0x2a9d8f, 0xe9c46a,
                0xf4a261, 0xe76f51, 0x2a9d8f, 0x264653
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        // åˆå§‹åŒ–
        window.onload = init;
    </script>
</body>
</html>